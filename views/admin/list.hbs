<div class="container-fluid px-4 mt-3">

  <!-- Header / Actions -->
  <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
    <h1 class="fw-bold text-danger m-0">Flights</h1>
    <div class="d-flex gap-2">
      <button class="btn btn-outline-secondary" onclick="window.location.reload()">
        <i class="bi bi-arrow-clockwise me-1"></i> Refresh
      </button>
      <a href="/admin/create" class="btn btn-danger">
        <i class="bi bi-plus-circle me-2"></i> Add Flight
      </a>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="row g-3 mb-3">
    <div class="col-12 col-md-4">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <div class="text-muted small">Total Flights</div>
              <div class="fs-3 fw-bold">{{flights.length}}</div>
            </div>
            <i class="bi bi-airplane-engines fs-1 text-danger opacity-75"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-4">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body">
          <div class="text-muted small mb-1">Search</div>
          <div class="input-group">
            <span class="input-group-text bg-danger text-white border-danger">
              <i class="bi bi-search"></i>
            </span>
            <input type="text" id="flightFilter" class="form-control" placeholder="Search flight number, origin, destination...">
          </div>
          <div class="form-text">Tip: Try destinations like “Cebu” or flight number “AA101”.</div>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-4">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body">
          <div class="text-muted small mb-1">Quick Links</div>
          <div class="d-flex gap-2 flex-wrap">
            <a href="/admin" class="btn btn-outline-danger btn-sm"><i class="bi bi-speedometer2 me-1"></i>Dashboard</a>
            <a href="/admin/reservations" class="btn btn-outline-danger btn-sm"><i class="bi bi-journal-bookmark me-1"></i>Reservations</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Table -->
  {{#if flights.length}}
  <div class="card shadow-sm">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
          <thead class="table-danger text-center">
            <tr>
              <th>Flight No.</th>
              <th>Route</th>
              <th>Departure</th>
              <th>Arrival</th>
              <th>Aircraft</th>
              <th>Seats</th>
              <th>Price (₱)</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="flightTable">
          {{#each flights}}
            <tr id="flight-{{this._id}}" class="text-center">
              <td class="fw-semibold">{{this.flightNumber}}</td>
              <td>{{this.origin}} → {{this.destination}}</td>
              <td>{{this.departureDate}} {{this.departureTime}}</td>
              <td>{{this.arrivalTime}}</td>
              <td>{{this.aircraft}}</td>
              <td>{{this.seatCapacity}}</td>
              <td>{{this.price}}</td>
              <td>
                <span class="badge
                  {{#if (eq this.status 'On Time')}}bg-success{{/if}}
                  {{#if (eq this.status 'Delayed')}}bg-warning text-dark{{/if}}
                  {{#if (eq this.status 'Cancelled')}}bg-danger{{/if}}
                  {{#if (eq this.status 'Scheduled')}}bg-secondary{{/if}}">
                  {{this.status}}
                </span>
              </td>
              <td>
                <a href="/admin/edit/{{this._id}}" class="btn btn-sm btn-outline-primary me-1" title="Edit">
                  <i class="bi bi-pencil"></i>
                </a>
                <button class="btn btn-sm btn-outline-danger deleteFlightBtn" data-id="{{this._id}}" title="Delete">
                  <i class="bi bi-trash"></i>
                </button>
              </td>
            </tr>
          {{/each}}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {{else}}
    <div class="alert alert-secondary text-center" role="alert">
      No flights found. Click <a href="/admin/create" class="alert-link">here</a> to add one.
    </div>
  {{/if}}
</div>

<!-- Toast -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
  <div id="toast" class="toast align-items-center text-white bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="toastBody"></div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>

<style>

</style>

<script>
// ✅ Persist flight search (localStorage) — safe add
document.addEventListener("DOMContentLoaded", () => {
  const input = document.getElementById("flightFilter");
  if (!input) return;

  const key = "flight_search";
  const saved = localStorage.getItem(key);
  if (saved) {
    input.value = saved;
    input.dispatchEvent(new Event("input"));
  }
  input.addEventListener("input", () => {
    localStorage.setItem(key, input.value);
  });
});
</script>
