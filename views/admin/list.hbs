<div class="container-fluid px-4 mt-3">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
    <h1 class="fw-bold text-danger m-0">All Flights</h1>
    <div class="d-flex gap-2">
      <button class="btn btn-outline-secondary" onclick="window.location.reload()">
        <i class="bi bi-arrow-clockwise me-1"></i> Refresh
      </button>
      <a href="/admin/create" class="btn btn-danger">
        <i class="bi bi-plus-circle me-2"></i> Add Flight
      </a>
    </div>
  </div>

  <!-- Search + Stats -->
  <div class="d-flex justify-content-between align-items-center flex-wrap mb-3">
    <div class="input-group" style="max-width:400px;">
      <span class="input-group-text bg-danger text-white border-danger">
        <i class="bi bi-search"></i>
      </span>
      <input type="text" id="flightFilter" class="form-control" placeholder="Search flight number, origin, or destination...">
    </div>

    <div class="text-muted small mt-2 mt-md-0">
      Total Flights: <span class="fw-bold">{{flights.length}}</span>
    </div>
  </div>

  {{#if flights.length}}
    <div class="table-responsive mt-3">
      <table class="table table-striped table-hover align-middle shadow-sm">
        <thead class="table-danger text-center">
          <tr>
            <th>Flight No.</th>
            <th>Origin</th>
            <th>Destination</th>
            <th>Departure</th>
            <th>Arrival</th>
            <th>Aircraft</th>
            <th>Seats</th>
            <th>Price (â‚±)</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="flightTable">
          {{#each flights}}
          <tr id="flight-{{this._id}}" class="text-center">
            <td>{{this.flightNumber}}</td>
            <td>{{this.origin}}</td>
            <td>{{this.destination}}</td>
            <td>{{this.departureDate}} {{this.departureTime}}</td>
            <td>{{this.arrivalTime}}</td>
            <td>{{this.aircraft}}</td>
            <td>{{this.seatCapacity}}</td>
            <td>{{this.price}}</td>
            <td>
              <span class="badge
                {{#if (eq this.status 'On Time')}}bg-success{{/if}}
                {{#if (eq this.status 'Delayed')}}bg-warning text-dark{{/if}}
                {{#if (eq this.status 'Cancelled')}}bg-danger{{/if}}
                {{#if (eq this.status 'Scheduled')}}bg-secondary{{/if}}">
                {{this.status}}
              </span>
            </td>
            <td>
              <a href="/admin/edit/{{this._id}}" class="btn btn-sm btn-outline-primary me-1" title="Edit">
                <i class="bi bi-pencil"></i>
              </a>
              <button class="btn btn-sm btn-outline-danger" title="Delete" onclick="deleteFlight('{{this._id}}')">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
          {{/each}}
        </tbody>
      </table>
    </div>
  {{else}}
    <div class="alert alert-secondary text-center" role="alert">
      No flights found. Click <a href="/admin/create" class="alert-link">here</a> to add one.
    </div>
  {{/if}}
</div>
 
 <!-- ======== TOAST (Bootstrap) ======== -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
  <div id="toast" class="toast align-items-center text-white bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="toastBody"></div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>

<!-- ========== STYLE ========== -->
<style>
.container-fluid { 
  max-width: 95%; 
  margin: auto; 
}
.table th, .table td { 
  vertical-align: middle; 
}
.table-hover tbody tr:hover { 
  background-color: #fff5f5; 
  transition: background-color 0.2s ease; 
  }
.table th { 
  cursor: pointer; 
  user-select: none; 
  }
.table th:hover { 
  background-color: 
  #ffe6e6; 
  }
.badge { 
  font-size: 0.85rem; 
  padding: 6px 10px; 
  border-radius: 8px; 
  }
.input-group .form-control:focus {
  border-color: #dc3545;
  box-shadow: 0 0 0 0.15rem rgba(220,53,69,.25);
}
.btn-outline-primary:hover { 
  background-color:#0d6efd; 
  color:white; 
  }
.btn-outline-danger:hover { 
  background-color:#dc3545; 
  color:white; 
  }
</style>

<!-- ======== SCRIPT ======== -->
<script>
/* Toast helper */
function showToast(message, success = true) {
  const toastEl = document.getElementById('toast');
  toastEl.classList.toggle('bg-danger', !success);
  toastEl.classList.toggle('bg-success', success);
  document.getElementById('toastBody').innerText = message;
  new bootstrap.Toast(toastEl).show();
}

/* Delete flight */
async function deleteFlight(id) {
  if (!confirm('Are you sure you want to delete this flight?')) return;
  try {
    const res = await fetch(`/admin/delete/${id}`, { method: 'DELETE' });
    const data = await res.json();
    if (res.ok) {
      document.getElementById(`flight-${id}`).remove();
      showToast(data.message || 'Flight deleted successfully', true);
    } else {
      showToast(data.message || 'Failed to delete flight', false);
    }
  } catch (err) {
    console.error(err);
    showToast('Error deleting flight.', false);
  }
}

/* Search filter */
document.getElementById('flightFilter').addEventListener('keyup', e => {
  const query = e.target.value.toLowerCase();
  document.querySelectorAll('#flightTable tr').forEach(row => {
    const text = row.innerText.toLowerCase();
    row.style.display = text.includes(query) ? '' : 'none';
  });
});

/* Column sort */
document.querySelectorAll('th').forEach(th => {
  th.addEventListener('click', () => {
    const index = Array.from(th.parentNode.children).indexOf(th);
    const rows = Array.from(document.querySelectorAll('#flightTable tr'));
    rows.sort((a, b) => {
      const aText = a.children[index].innerText.toLowerCase();
      const bText = b.children[index].innerText.toLowerCase();
      return aText.localeCompare(bText, undefined, { numeric: true });
    });
    document.querySelector('#flightTable').append(...rows);
  });
});
</script>
