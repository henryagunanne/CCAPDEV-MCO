<div class="container-fluid px-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="fw-bold text-danger">All Flights</h1>
    <a href="/admin/create" class="btn btn-danger">
      <i class="bi bi-plus-circle me-2"></i> Add Flight
    </a>
  </div>

  {{#if flights.length}}
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle shadow-sm">
        <thead class="table-danger text-center">
          <tr>
            <th>Flight No.</th>
            <th>Origin</th>
            <th>Destination</th>
            <th>Departure</th>
            <th>Arrival</th>
            <th>Aircraft</th>
            <th>Seats</th>
            <th>Price (â‚±)</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {{#each flights}}
          <tr id="flight-{{this._id}}" class="text-center">
            <td>{{this.flightNumber}}</td>
            <td>{{this.origin}}</td>
            <td>{{this.destination}}</td>
            <td>{{this.departureDate}} {{this.departureTime}}</td>
            <td>{{this.arrivalTime}}</td>
            <td>{{this.aircraft}}</td>
            <td>{{this.seatCapacity}}</td>
            <td>{{this.price}}</td>
            <td>
              <span class="badge 
                {{#if (eq this.status 'On Time')}}bg-success{{/if}}
                {{#if (eq this.status 'Delayed')}}bg-warning text-dark{{/if}}
                {{#if (eq this.status 'Cancelled')}}bg-danger{{/if}}
                {{#if (eq this.status 'Scheduled')}}bg-secondary{{/if}}">
                {{this.status}}
              </span>
            </td>
            <td>
              <a href="/admin/edit/{{this._id}}" class="btn btn-sm btn-outline-primary me-1">
                <i class="bi bi-pencil"></i>
              </a>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteFlight('{{this._id}}')">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
          {{/each}}
        </tbody>
      </table>
    </div>
  {{else}}
    <div class="alert alert-secondary text-center" role="alert">
      No flights found. Click <a href="/admin/create" class="alert-link">here</a> to add one.
    </div>
  {{/if}}
</div>

<!-- ========== STYLE ========== -->
<style>
.table th, .table td {
  vertical-align: middle;
}
.table-hover tbody tr:hover {
  background-color: #fff5f5;
}
.badge {
  font-size: 0.85rem;
  padding: 6px 10px;
  border-radius: 8px;
}
</style>

<!-- ========== SCRIPT ========== -->
<script>
async function deleteFlight(id) {
  if (!confirm('Are you sure you want to delete this flight?')) return;

  try {
    const res = await fetch(`/admin/delete/${id}`, { method: 'DELETE' });
    const data = await res.json();

    if (res.ok) {
      document.getElementById(`flight-${id}`).remove();
      alert(data.message || 'Flight deleted successfully');
    } else {
      alert(data.message || 'Failed to delete flight');
    }
  } catch (err) {
    console.error(err);
    alert('Error deleting flight.');
  }
}
</script>
